#!/usr/bin/env node
/* Apply curated translations for specific keys across locales */
const fs = require('fs')
const path = require('path')

const targets = [
  { dir: path.join(__dirname, '..', 'public', 'locales'), keys: [
    'settings.appInfo','settings.currentVersion','settings.latestVersion','settings.platform','settings.signing','settings.signingUnknown','settings.openRelease','settings.updateNowPwa','settings.checkForUpdates','settings.upToDate','settings.downloadWindows','settings.downloadApk','settings.downloadAab','settings.updateError','update.newReleaseAvailable'
  ]},
  { dir: path.join(__dirname, '..', 'src', 'i18n', 'locales'), keys: [
    'settings.soundEnabled','settings.soundEnabledDesc','invite.caption','chat.resolvingMedia','chat.load','chat.mediaUnavailable','call.incomingCall','call.isCallingYou','call.expiresIn','call.accept','call.reject','call.activeCall','call.joinCall','call.leaveCall','call.startCall','call.endCall','call.callEnded','call.callExpired','call.callRejected','call.shareCall','call.shareableLink','call.inviteMessage','call.copyInvite','call.shareCallTitle','call.join','call.joinActiveRoom','call.ringing','call.connecting','call.callInProgress','notification.callMissed','notification.callEnded','room.join','room.joinActiveRoom','room.activeUsers'
  ]}
]

const translations = {
  es: {
    // public
    'settings.appInfo': 'Información de la aplicación',
    'settings.currentVersion': 'Actual',
    'settings.latestVersion': 'Última',
    'settings.platform': 'Plataforma',
    'settings.signing': 'Firma',
    'settings.signingUnknown': 'No disponible en esta compilación',
    'settings.openRelease': 'Abrir la última versión',
    'settings.updateNowPwa': 'Actualizar PWA ahora',
    'settings.checkForUpdates': 'Buscar actualizaciones',
    'settings.upToDate': 'Está al día.',
    'settings.downloadWindows': 'Descargar para Windows',
    'settings.downloadApk': 'Descargar APK',
    'settings.downloadAab': 'Descargar AAB',
    'settings.updateError': 'No se pudo comprobar actualizaciones',
    'update.newReleaseAvailable': 'Nueva versión disponible: {tag}',
    // src
    'settings.soundEnabled': 'Notificaciones de sonido',
    'settings.soundEnabledDesc': 'Reproducir tonos para notificaciones y llamadas',
    'invite.caption': 'Conéctate de forma segura conmigo en GlobGram:',
    'chat.resolvingMedia': 'Resolviendo medios…',
    'chat.load': 'Cargar',
    'chat.mediaUnavailable': 'Medio no disponible. El remitente debe habilitar el servidor de carga o estar en línea para mem://.',
    'call.incomingCall': 'Llamada entrante',
    'call.isCallingYou': 'te está llamando',
    'call.expiresIn': 'Expira en',
    'call.accept': 'Aceptar',
    'call.reject': 'Rechazar',
    'call.activeCall': 'Llamada activa',
    'call.joinCall': 'Unirse a la llamada',
    'call.leaveCall': 'Salir de la llamada',
    'call.startCall': 'Iniciar llamada',
    'call.endCall': 'Finalizar llamada',
    'call.callEnded': 'Llamada finalizada',
    'call.callExpired': 'La llamada expiró',
    'call.callRejected': 'Llamada rechazada',
    'call.shareCall': 'Compartir llamada',
    'call.shareableLink': 'Enlace para compartir',
    'call.inviteMessage': 'Mensaje de invitación',
    'call.copyInvite': 'Copiar invitación',
    'call.shareCallTitle': 'Únete a mi llamada de GlobGram',
    'call.join': 'Unirse',
    'call.joinActiveRoom': 'Unirse a la sala activa',
    'call.ringing': 'Sonando...',
    'call.connecting': 'Conectando...',
    'call.callInProgress': 'Llamada en curso',
    'notification.callMissed': 'Llamada perdida',
    'notification.callEnded': 'Llamada finalizada',
    'room.join': 'Unirse',
    'room.joinActiveRoom': 'Unirse a la sala activa',
    'room.activeUsers': '{count} usuarios activos'
  },
  fr: {
    'settings.appInfo': "Informations de l’application",
    'settings.currentVersion': 'Actuelle',
    'settings.latestVersion': 'Dernière',
    'settings.platform': 'Plateforme',
    'settings.signing': 'Signature',
    'settings.signingUnknown': 'Non disponible dans cette build',
    'settings.openRelease': 'Ouvrir la dernière publication',
    'settings.updateNowPwa': 'Mettre à jour la PWA maintenant',
    'settings.checkForUpdates': 'Rechercher des mises à jour',
    'settings.upToDate': 'Vous êtes à jour.',
    'settings.downloadWindows': 'Télécharger pour Windows',
    'settings.downloadApk': 'Télécharger l’APK',
    'settings.downloadAab': 'Télécharger l’AAB',
    'settings.updateError': 'Échec de la vérification des mises à jour',
    'update.newReleaseAvailable': 'Nouvelle version disponible : {tag}',
    'settings.soundEnabled': 'Notifications sonores',
    'settings.soundEnabledDesc': 'Jouer des sonneries pour les notifications et les appels',
    'invite.caption': 'Se connecter en toute sécurité avec moi sur GlobGram :',
    'chat.resolvingMedia': 'Résolution des médias…',
    'chat.load': 'Charger',
    'chat.mediaUnavailable': 'Média indisponible. L’expéditeur doit activer le serveur de téléversement ou être en ligne pour mem://.',
    'call.incomingCall': 'Appel entrant',
    'call.isCallingYou': 'vous appelle',
    'call.expiresIn': 'Expire dans',
    'call.accept': 'Accepter',
    'call.reject': 'Refuser',
    'call.activeCall': 'Appel en cours',
    'call.joinCall': 'Rejoindre l’appel',
    'call.leaveCall': 'Quitter l’appel',
    'call.startCall': 'Démarrer l’appel',
    'call.endCall': 'Terminer l’appel',
    'call.callEnded': 'Appel terminé',
    'call.callExpired': 'Appel expiré',
    'call.callRejected': 'Appel refusé',
    'call.shareCall': 'Partager l’appel',
    'call.shareableLink': 'Lien partageable',
    'call.inviteMessage': 'Message d’invitation',
    'call.copyInvite': 'Copier l’invitation',
    'call.shareCallTitle': 'Rejoignez-moi sur un appel GlobGram',
    'call.join': 'Rejoindre',
    'call.joinActiveRoom': 'Rejoindre la salle active',
    'call.ringing': 'Sonnerie…',
    'call.connecting': 'Connexion…',
    'call.callInProgress': 'Appel en cours',
    'notification.callMissed': 'Appel manqué',
    'notification.callEnded': 'Appel terminé',
    'room.join': 'Rejoindre',
    'room.joinActiveRoom': 'Rejoindre la salle active',
    'room.activeUsers': '{count} utilisateurs actifs'
  },
  de: {
    'settings.appInfo': 'App-Informationen',
    'settings.currentVersion': 'Aktuell',
    'settings.latestVersion': 'Neueste',
    'settings.platform': 'Plattform',
    'settings.signing': 'Signierung',
    'settings.signingUnknown': 'In diesem Build nicht verfügbar',
    'settings.openRelease': 'Neueste Version öffnen',
    'settings.updateNowPwa': 'PWA jetzt aktualisieren',
    'settings.checkForUpdates': 'Nach Updates suchen',
    'settings.upToDate': 'Sie sind auf dem neuesten Stand.',
    'settings.downloadWindows': 'Für Windows herunterladen',
    'settings.downloadApk': 'APK herunterladen',
    'settings.downloadAab': 'AAB herunterladen',
    'settings.updateError': 'Updates konnten nicht geprüft werden',
    'update.newReleaseAvailable': 'Neue Version verfügbar: {tag}',
    'settings.soundEnabled': 'Tonbenachrichtigungen',
    'settings.soundEnabledDesc': 'Klingeltöne für Benachrichtigungen und Anrufe abspielen',
    'invite.caption': 'Sicher mit mir auf GlobGram verbinden:',
    'chat.resolvingMedia': 'Medien werden aufgelöst…',
    'chat.load': 'Laden',
    'chat.mediaUnavailable': 'Medium nicht verfügbar. Der Absender muss den Upload-Server aktivieren oder für mem:// online sein.',
    'call.incomingCall': 'Eingehender Anruf',
    'call.isCallingYou': 'ruft dich an',
    'call.expiresIn': 'Läuft ab in',
    'call.accept': 'Annehmen',
    'call.reject': 'Ablehnen',
    'call.activeCall': 'Aktiver Anruf',
    'call.joinCall': 'Anruf beitreten',
    'call.leaveCall': 'Anruf verlassen',
    'call.startCall': 'Anruf starten',
    'call.endCall': 'Anruf beenden',
    'call.callEnded': 'Anruf beendet',
    'call.callExpired': 'Anruf abgelaufen',
    'call.callRejected': 'Anruf abgelehnt',
    'call.shareCall': 'Anruf teilen',
    'call.shareableLink': 'Teilbarer Link',
    'call.inviteMessage': 'Einladungstext',
    'call.copyInvite': 'Einladung kopieren',
    'call.shareCallTitle': 'Tritt meinem GlobGram-Anruf bei',
    'call.join': 'Beitreten',
    'call.joinActiveRoom': 'Aktivem Raum beitreten',
    'call.ringing': 'Klingelt…',
    'call.connecting': 'Verbinde…',
    'call.callInProgress': 'Anruf läuft',
    'notification.callMissed': 'Verpasster Anruf',
    'notification.callEnded': 'Anruf beendet',
    'room.join': 'Beitreten',
    'room.joinActiveRoom': 'Aktivem Raum beitreten',
    'room.activeUsers': '{count} aktive Benutzer'
  },
  pt: {
    'settings.appInfo': 'Informações do app',
    'settings.currentVersion': 'Atual',
    'settings.latestVersion': 'Mais recente',
    'settings.platform': 'Plataforma',
    'settings.signing': 'Assinatura',
    'settings.signingUnknown': 'Não disponível nesta build',
    'settings.openRelease': 'Abrir a versão mais recente',
    'settings.updateNowPwa': 'Atualizar PWA agora',
    'settings.checkForUpdates': 'Verificar atualizações',
    'settings.upToDate': 'Você está atualizado.',
    'settings.downloadWindows': 'Baixar para Windows',
    'settings.downloadApk': 'Baixar APK',
    'settings.downloadAab': 'Baixar AAB',
    'settings.updateError': 'Falha ao verificar atualizações',
    'update.newReleaseAvailable': 'Nova versão disponível: {tag}',
    'settings.soundEnabled': 'Notificações de som',
    'settings.soundEnabledDesc': 'Reproduzir toques para notificações e chamadas',
    'invite.caption': 'Conecte-se com segurança comigo no GlobGram:',
    'chat.resolvingMedia': 'Resolvendo mídia…',
    'chat.load': 'Carregar',
    'chat.mediaUnavailable': 'Mídia indisponível. O remetente deve habilitar o servidor de upload ou estar online para mem://.',
    'call.incomingCall': 'Chamada recebida',
    'call.isCallingYou': 'está ligando para você',
    'call.expiresIn': 'Expira em',
    'call.accept': 'Aceitar',
    'call.reject': 'Recusar',
    'call.activeCall': 'Chamada ativa',
    'call.joinCall': 'Entrar na chamada',
    'call.leaveCall': 'Sair da chamada',
    'call.startCall': 'Iniciar chamada',
    'call.endCall': 'Encerrar chamada',
    'call.callEnded': 'Chamada encerrada',
    'call.callExpired': 'Chamada expirada',
    'call.callRejected': 'Chamada recusada',
    'call.shareCall': 'Compartilhar chamada',
    'call.shareableLink': 'Link compartilhável',
    'call.inviteMessage': 'Mensagem de convite',
    'call.copyInvite': 'Copiar convite',
    'call.shareCallTitle': 'Junte-se a mim em uma chamada GlobGram',
    'call.join': 'Entrar',
    'call.joinActiveRoom': 'Entrar na sala ativa',
    'call.ringing': 'Tocando...',
    'call.connecting': 'Conectando...',
    'call.callInProgress': 'Chamada em andamento',
    'notification.callMissed': 'Chamada perdida',
    'notification.callEnded': 'Chamada encerrada',
    'room.join': 'Entrar',
    'room.joinActiveRoom': 'Entrar na sala ativa',
    'room.activeUsers': '{count} usuários ativos'
  },
  ru: {
    'settings.appInfo': 'Информация о приложении',
    'settings.currentVersion': 'Текущая',
    'settings.latestVersion': 'Последняя',
    'settings.platform': 'Платформа',
    'settings.signing': 'Подпись',
    'settings.signingUnknown': 'Недоступно в этой сборке',
    'settings.openRelease': 'Открыть последний релиз',
    'settings.updateNowPwa': 'Обновить PWA сейчас',
    'settings.checkForUpdates': 'Проверить обновления',
    'settings.upToDate': 'У вас установлена последняя версия.',
    'settings.downloadWindows': 'Скачать для Windows',
    'settings.downloadApk': 'Скачать APK',
    'settings.downloadAab': 'Скачать AAB',
    'settings.updateError': 'Не удалось проверить обновления',
    'update.newReleaseAvailable': 'Доступен новый релиз: {tag}',
    'settings.soundEnabled': 'Звуковые уведомления',
    'settings.soundEnabledDesc': 'Воспроизводить рингтоны для уведомлений и звонков',
    'invite.caption': 'Безопасно подключайтесь со мной в GlobGram:',
    'chat.resolvingMedia': 'Обработка медиа…',
    'chat.load': 'Загрузить',
    'chat.mediaUnavailable': 'Медиа недоступно. Отправитель должен включить сервер загрузки или быть онлайн для mem://.',
    'call.incomingCall': 'Входящий звонок',
    'call.isCallingYou': 'звонит вам',
    'call.expiresIn': 'Истекает через',
    'call.accept': 'Принять',
    'call.reject': 'Отклонить',
    'call.activeCall': 'Идет звонок',
    'call.joinCall': 'Присоединиться к звонку',
    'call.leaveCall': 'Покинуть звонок',
    'call.startCall': 'Начать звонок',
    'call.endCall': 'Завершить звонок',
    'call.callEnded': 'Звонок завершен',
    'call.callExpired': 'Звонок истек',
    'call.callRejected': 'Звонок отклонен',
    'call.shareCall': 'Поделиться звонком',
    'call.shareableLink': 'Ссылка для доступа',
    'call.inviteMessage': 'Пригласительное сообщение',
    'call.copyInvite': 'Копировать приглашение',
    'call.shareCallTitle': 'Присоединяйтесь ко мне к звонку GlobGram',
    'call.join': 'Присоединиться',
    'call.joinActiveRoom': 'Присоединиться к активной комнате',
    'call.ringing': 'Звонит...',
    'call.connecting': 'Подключение...',
    'call.callInProgress': 'Идет звонок',
    'notification.callMissed': 'Пропущенный звонок',
    'notification.callEnded': 'Звонок завершен',
    'room.join': 'Присоединиться',
    'room.joinActiveRoom': 'Присоединиться к активной комнате',
    'room.activeUsers': '{count} активных пользователей'
  },
  fa: {
    'settings.appInfo': 'اطلاعات برنامه',
    'settings.currentVersion': 'نسخه فعلی',
    'settings.latestVersion': 'آخرین',
    'settings.platform': 'پلتفرم',
    'settings.signing': 'امضا',
    'settings.signingUnknown': 'در این بیلد در دسترس نیست',
    'settings.openRelease': 'باز کردن آخرین انتشار',
    'settings.updateNowPwa': 'به‌روزرسانی PWA اکنون',
    'settings.checkForUpdates': 'بررسی برای به‌روزرسانی‌ها',
    'settings.upToDate': 'شما به‌روز هستید.',
    'settings.downloadWindows': 'دانلود برای ویندوز',
    'settings.downloadApk': 'دانلود APK',
    'settings.downloadAab': 'دانلود AAB',
    'settings.updateError': 'بررسی به‌روزرسانی‌ها ناموفق بود',
    'update.newReleaseAvailable': 'نسخه جدید در دسترس است: {tag}',
    'settings.soundEnabled': 'فعال‌سازی اعلان‌های صدا',
    'settings.soundEnabledDesc': 'پخش زنگ برای اعلان‌ها و تماس‌ها',
    'invite.caption': 'به‌صورت امن با من در GlobGram متصل شوید:',
    'chat.resolvingMedia': 'در حال پردازش رسانه…',
    'chat.load': 'بارگذاری',
    'chat.mediaUnavailable': 'رسانه در دسترس نیست. فرستنده باید سرور بارگذاری را فعال کند یا برای mem:// برخط باشد.',
    'call.incomingCall': 'تماس ورودی',
    'call.isCallingYou': 'در حال تماس با شما است',
    'call.expiresIn': 'انقضا در',
    'call.accept': 'پذیرفتن',
    'call.reject': 'رد کردن',
    'call.activeCall': 'تماس فعال',
    'call.joinCall': 'پیوستن به تماس',
    'call.leaveCall': 'ترک تماس',
    'call.startCall': 'شروع تماس',
    'call.endCall': 'پایان تماس',
    'call.callEnded': 'تماس پایان یافت',
    'call.callExpired': 'تماس منقضی شد',
    'call.callRejected': 'تماس رد شد',
    'call.shareCall': 'اشتراک‌گذاری تماس',
    'call.shareableLink': 'پیوند قابل اشتراک',
    'call.inviteMessage': 'پیام دعوت',
    'call.copyInvite': 'کپی دعوت‌نامه',
    'call.shareCallTitle': 'به تماس GlobGram من بپیوندید',
    'call.join': 'پیوستن',
    'call.joinActiveRoom': 'پیوستن به اتاق فعال',
    'call.ringing': 'در حال زنگ خوردن...',
    'call.connecting': 'در حال اتصال...',
    'call.callInProgress': 'تماس در حال انجام',
    'notification.callMissed': 'تماس از دست رفته',
    'notification.callEnded': 'تماس پایان یافت',
    'room.join': 'پیوستن',
    'room.joinActiveRoom': 'پیوستن به اتاق فعال',
    'room.activeUsers': '{count} کاربر فعال'
  },
  ar: {
    'settings.appInfo': 'معلومات التطبيق',
    'settings.currentVersion': 'الحالي',
    'settings.latestVersion': 'الأحدث',
    'settings.platform': 'المنصة',
    'settings.signing': 'التوقيع',
    'settings.signingUnknown': 'غير متوفر في هذا البناء',
    'settings.openRelease': 'فتح آخر إصدار',
    'settings.updateNowPwa': 'تحديث PWA الآن',
    'settings.checkForUpdates': 'التحقق من التحديثات',
    'settings.upToDate': 'أنت على أحدث إصدار.',
    'settings.downloadWindows': 'تنزيل لنظام Windows',
    'settings.downloadApk': 'تنزيل APK',
    'settings.downloadAab': 'تنزيل AAB',
    'settings.updateError': 'فشل التحقق من التحديثات',
    'update.newReleaseAvailable': 'إصدار جديد متوفر: {tag}',
    'settings.soundEnabled': 'تمكين إشعارات الصوت',
    'settings.soundEnabledDesc': 'تشغيل نغمات للإشعارات والمكالمات',
    'invite.caption': 'اتصل بي بأمان على GlobGram:',
    'chat.resolvingMedia': 'جارٍ معالجة الوسائط…',
    'chat.load': 'تحميل',
    'chat.mediaUnavailable': 'الوسائط غير متاحة. يجب أن يقوم المُرسِل بتمكين خادم الرفع أو أن يكون متصلاً لـ mem://.',
    'call.incomingCall': 'مكالمة واردة',
    'call.isCallingYou': 'يتصل بك',
    'call.expiresIn': 'تنتهي خلال',
    'call.accept': 'قبول',
    'call.reject': 'رفض',
    'call.activeCall': 'مكالمة نشطة',
    'call.joinCall': 'الانضمام إلى المكالمة',
    'call.leaveCall': 'مغادرة المكالمة',
    'call.startCall': 'بدء مكالمة',
    'call.endCall': 'إنهاء المكالمة',
    'call.callEnded': 'انتهت المكالمة',
    'call.callExpired': 'انتهت صلاحية المكالمة',
    'call.callRejected': 'تم رفض المكالمة',
    'call.shareCall': 'مشاركة المكالمة',
    'call.shareableLink': 'رابط قابل للمشاركة',
    'call.inviteMessage': 'رسالة دعوة',
    'call.copyInvite': 'نسخ الدعوة',
    'call.shareCallTitle': 'انضم إليّ في مكالمة GlobGram',
    'call.join': 'انضمام',
    'call.joinActiveRoom': 'الانضمام إلى الغرفة النشطة',
    'call.ringing': 'يرن...',
    'call.connecting': 'جارٍ الاتصال...',
    'call.callInProgress': 'مكالمة قيد التقدم',
    'notification.callMissed': 'مكالمة فائتة',
    'notification.callEnded': 'انتهت المكالمة',
    'room.join': 'انضمام',
    'room.joinActiveRoom': 'الانضمام إلى الغرفة النشطة',
    'room.activeUsers': '{count} مستخدمين نشطين'
  }
}

function setDeep(obj, key, value) {
  const parts = key.split('.')
  let cur = obj
  for (let i = 0; i < parts.length - 1; i++) {
    const p = parts[i]
    if (!cur[p] || typeof cur[p] !== 'object') cur[p] = {}
    cur = cur[p]
  }
  cur[parts[parts.length - 1]] = value
}

let changes = 0
for (const { dir, keys } of targets) {
  if (!fs.existsSync(dir)) continue
  const files = fs.readdirSync(dir).filter(f => f.endsWith('.json') && f !== 'en.json')
  for (const f of files) {
    const lang = path.basename(f, '.json')
    const map = translations[lang]
    if (!map) continue
    const filePath = path.join(dir, f)
    const obj = JSON.parse(fs.readFileSync(filePath, 'utf8'))
    let updated = 0
    for (const k of keys) {
      if (map[k]) {
        setDeep(obj, k, map[k])
        updated++
      }
    }
    if (updated > 0) {
      fs.writeFileSync(filePath, JSON.stringify(obj, null, '\t'))
      changes += updated
      console.log(`Updated ${f} (${updated} keys) in ${path.relative(process.cwd(), dir)}`)
    }
  }
}

console.log(`Done. Total keys updated: ${changes}`)
