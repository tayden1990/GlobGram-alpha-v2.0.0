/* Enhanced conferencing layout inspired by palerdot/video-conferencing-ui */
.gg-root{position:relative;inset:0;display:flex;flex-direction:column;height:100vh;height:100dvh;min-height:100svh;width:100%;background:#0b0b0d;z-index:0}
.gg-stage{flex:1;min-height:0;display:flex}

/* Mobile viewport optimization */
@media (max-width:520px){
  .gg-root{
    height:100vh;
    height:100dvh;
    min-height:100svh;
    /* Ensure no overflow on mobile */
    overflow:hidden;
  }
  
  .gg-stage{
    /* Use remaining space after toolbar on mobile */
    height:calc(100vh - 96px);
    height:calc(100dvh - 96px);
    min-height:calc(100svh - 96px);
  }
}

/* Enhanced participant tiles with smooth animations */
.gg-tile{
  position:relative;
  border-radius:10px;
  overflow:hidden;
  background:#111;
  isolation:isolate;
  aspect-ratio:auto!important;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  transform: scale(1);
  opacity: 1;
  animation: fadeInScale 0.3s ease-out forwards;
}

@keyframes fadeInScale {
  from {
    opacity: 0;
    transform: scale(0.9);
  }
  to {
    opacity: 1;
    transform: scale(1);
  }
}

.gg-tile:hover {
  transform: scale(1.02);
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
}

/* Ensure ParticipantTile fills its parent and video scales with contain */
.lk-participant-tile{
  width:100%;
  height:100%;
  display:block;
  aspect-ratio:auto !important;
  border-radius: inherit;
}

.lk-participant-tile video{
  /* Base video styling - allow stabilizer to override */
  width:100%;
  height:100%;
  max-width:100%;
  max-height:100%;
  background:#0b0b0d;
  border-radius: inherit;
  /* Stabilization-friendly defaults - no !important to allow override */
  object-fit: contain;
  object-position: center center;
  aspect-ratio: auto;
  /* Stabilization support */
  transition: none; /* Prevent CSS transitions from interfering */
}

/* Video stabilization classes - highest specificity to override everything */
.lk-participant-tile video.video-stabilized {
  object-fit: cover !important;
  object-position: center center !important;
  width: var(--stable-width, 100%) !important;
  height: var(--stable-height, 100%) !important;
  transform: translateZ(0) !important;
  transition: none !important;
  animation: none !important;
  overflow: hidden !important;
  pointer-events: none !important;
  user-select: none !important;
  /* Prevent any browser scaling or adjustments */
  image-rendering: auto !important;
  backface-visibility: hidden !important;
  will-change: auto !important;
}

/* Anti-jumping container stabilization */
.lk-participant-tile:has(video.video-stabilized) {
  overflow: hidden !important;
  /* Prevent container from causing jumps */
  contain: layout style !important;
}

/* ULTIMATE ANTI-JUMPING PROTECTION */
/* Disable ALL animations and layout-affecting changes during video calls */
.call-panel .gg-tile,
.call-panel .gg-tile *,
.call-panel .gg-placeholder,
.call-panel .gg-placeholder * {
  /* ZERO TOLERANCE FOR LAYOUT SHIFTS */
  animation: none !important;
  transform: none !important;
  transition: none !important;
  will-change: auto !important;
  
  /* Force layout containment */
  contain: layout style !important;
  
  /* Prevent any size changes */
  box-sizing: border-box !important;
  
  /* Lock positioning */
  position: relative !important;
}

/* Special protection for video elements */
.call-panel video,
.call-panel .stable-video {
  /* MAXIMUM STABILITY */
  animation: none !important;
  transform: none !important;
  transition: none !important;
  will-change: auto !important;
  
  /* Force exact dimensions */
  object-fit: cover !important;
  object-position: center !important;
  
  /* Hardware acceleration without transforms */
  backface-visibility: hidden !important;
  -webkit-backface-visibility: hidden !important;
  
  /* Prevent any scaling or movement */
  min-width: 100% !important;
  min-height: 100% !important;
  max-width: 100% !important;
  max-height: 100% !important;
}

/* ULTIMATE VIDEO STABILITY - NO JUMPING ALLOWED */
.call-panel video,
.call-panel-overlay video,
video.stable-video,
.gg-tile video {
  /* ABSOLUTE STABILITY */
  animation: none !important;
  transform: none !important;
  transition: none !important;
  will-change: auto !important;
  
  /* Force exact positioning and sizing */
  position: relative !important;
  object-fit: cover !important;
  object-position: center !important;
  
  /* Lock all dimensions */
  width: 100% !important;
  height: 100% !important;
  min-width: 100% !important;
  min-height: 100% !important;
  max-width: 100% !important;
  max-height: 100% !important;
  
  /* Hardware acceleration without layout shifts */
  backface-visibility: hidden !important;
  -webkit-backface-visibility: hidden !important;
  
  /* Prevent any filter or backdrop changes that could cause jumps */
  filter: none !important;
  backdrop-filter: none !important;
  -webkit-backdrop-filter: none !important;
  
  /* Force layout containment */
  contain: layout style size paint !important;
  
  /* Prevent any margin/padding changes */
  margin: 0 !important;
  padding: 0 !important;
  border: none !important;
  outline: none !important;
  
  /* Override any inherited styles that could cause movement */
  top: auto !important;
  left: auto !important;
  right: auto !important;
  bottom: auto !important;
  
  /* Disable any pseudo-elements */
}

.call-panel video::before,
.call-panel video::after,
.call-panel-overlay video::before,
.call-panel-overlay video::after {
  content: none !important;
  display: none !important;
}

/* NUCLEAR OPTION: Disable all animations during video calls */
.call-panel *,
.call-panel-overlay *,
.call-panel *::before,
.call-panel *::after,
.call-panel-overlay *::before,
.call-panel-overlay *::after {
  animation-duration: 0s !important;
  animation-delay: 0s !important;
  transition-duration: 0s !important;
  transition-delay: 0s !important;
  transform: none !important;
  will-change: auto !important;
}
.gg-grid .lk-participant-tile video.video-stabilized,
.gg-grid .lk-participant-tile video.video-stabilized * {
  animation: none !important;
  transition: none !important;
  transform: translateZ(0) !important;
}

/* Hide built-in LiveKit labels/indicators to avoid double text & overflow */
.lk-participant-tile [class*="label"],
.lk-participant-name,
.lk-participant-metadata,
.lk-audio-signal{display:none!important}

/* Hide miscellaneous LiveKit overlays/icons for a cleaner tile */
.lk-participant-tile [class*="icon"],
.lk-participant-tile [class*="camera"],
.lk-participant-tile [class*="controls"],
.lk-participant-tile [class*="menu"],
.lk-participant-tile [class*="actions"],
.lk-participant-tile [data-lk-overlay]{ display:none !important; }

/* CSS rules removed to allow video stabilizer full control */

/* Enhanced placeholder styling */
.gg-placeholder{
  display:grid;
  place-items:center;
  background:#0f0f10;
  border-radius: inherit;
  transition: all 0.3s ease;
}

.gg-placeholder:hover {
  background:#1a1a1b;
}

/* Enhanced tile labels */
.gg-label{
  position:absolute;
  left:8px;
  bottom:8px;
  background:rgba(0,0,0,.6);
  color:#fff;
  padding:4px 8px;
  border-radius:6px;
  font-size:12px;
  font-weight: 500;
  backdrop-filter:blur(4px);
  max-width:70%;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
  border: 1px solid rgba(255, 255, 255, 0.1);
  transition: all 0.2s ease;
}

.gg-tile:hover .gg-label {
  background:rgba(0,0,0,.8);
  backdrop-filter:blur(6px);
}

/* Enhanced toolbar */
.gg-toolbar{
  --tool-h:56px;
  position:absolute;
  left:0;
  right:0;
  bottom:0;
  display:flex;
  flex-wrap:wrap;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  padding:10px max(12px, env(safe-area-inset-right,12px)) calc(10px + env(safe-area-inset-bottom,0px)) max(12px, env(safe-area-inset-left,12px));
  background:linear-gradient(180deg,rgba(0,0,0,.05) 0%, rgba(0,0,0,.5) 50%, rgba(0,0,0,.85) 100%);
  z-index:1000;
  color:#fff;
  pointer-events:auto;
  border-top:1px solid rgba(255,255,255,.08);
  min-height:var(--tool-h);
  backdrop-filter: blur(8px);
}

.gg-root.hide-ui .gg-toolbar{
  opacity:0;
  pointer-events:none;
  transition:opacity .25s ease;
}

.gg-toolbar{transition:opacity .2s ease}

/* Enhanced buttons */
.gg-btn{
  background:rgba(255,255,255,.12);
  border:1px solid rgba(255,255,255,.2);
  color:#fff;
  border-radius:10px;
  padding:10px 14px;
  cursor:pointer;
  backdrop-filter:blur(4px);
  transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
  font-weight: 500;
  position: relative;
  overflow: hidden;
}

.gg-btn::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
  transition: left 0.5s;
}

.gg-btn:hover::before {
  left: 100%;
}

.gg-btn:hover{
  background:rgba(255,255,255,.18);
  border-color:rgba(255,255,255,.3);
  transform: translateY(-1px);
  box-shadow: 0 4px 12px rgba(0,0,0,.3);
}

.gg-btn[aria-pressed="true"]{
  background: linear-gradient(135deg, #3b82f6, #1d4ed8);
  border-color: #2563eb;
  box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);
}

.gg-btn.danger{
  background: linear-gradient(135deg, #ef4444, #dc2626);
  border-color: #dc2626;
  box-shadow: 0 2px 8px rgba(239, 68, 68, 0.3);
}

.gg-btn.danger:hover{
  background: linear-gradient(135deg, #f87171, #ef4444);
  border-color: #ef4444;
}

.gg-left,.gg-center,.gg-right{display:flex;gap:8px;align-items:center}
.gg-center{flex:1;justify-content:center;min-width:0}
.gg-center .gg-btn{min-width:40px}
.gg-btn.icon{font-size:18px;line-height:1;padding:12px;}

/* Enhanced badge */
.gg-badge{
  background:rgba(255,255,255,.15);
  border:1px solid rgba(255,255,255,.25);
  padding:6px 12px;
  border-radius:999px;
  font-size:12px;
  font-weight: 600;
  backdrop-filter: blur(4px);
  transition: all 0.2s ease;
}

.gg-badge:hover {
  background:rgba(255,255,255,.2);
  border-color:rgba(255,255,255,.35);
}

/* Enhanced mobile responsiveness */
@media (max-width:520px){
  .gg-btn{padding:8px 10px;font-size:12px;border-radius:8px}
  .gg-left,.gg-center,.gg-right{gap:6px}
  .gg-toolbar{
    --tool-h:96px;
    display:grid;
    grid-template-columns:1fr 1fr;
    grid-template-areas:"left right" "center center";
    align-items:center;
    gap: 8px;
  }
  .gg-left{grid-area:left;justify-content:flex-start}
  .gg-center{grid-area:center;justify-content:center}
  .gg-right{grid-area:right;justify-content:flex-end}
  
  /* Mobile video optimization: maximize screen usage */
  .gg-grid{
    padding: 4px !important;
    gap: 4px !important;
    /* Ensure grid uses full available height minus toolbar */
    height: calc(100vh - 96px) !important;
    height: calc(100dvh - 96px) !important;
  }
  
  /* Mobile video tiles: fill available space better */
  .gg-tile{
    /* Remove artificial size constraints on mobile */
    max-width: none !important;
    max-height: none !important;
    min-width: 0 !important;
    min-height: 0 !important;
    /* Allow tiles to grow and fill available space */
    flex: 1 1 auto !important;
    width: 100% !important;
    height: 100% !important;
  }
  
  /* For single participant: use most of the screen */
  .gg-grid:has(.gg-tile:only-child) .gg-tile {
    width: 95vw !important;
    height: calc(85vh - 96px) !important;
    height: calc(85dvh - 96px) !important;
    max-width: 95vw !important;
    max-height: calc(85vh - 96px) !important;
  }
  
  /* For two participants: split screen vertically */
  .gg-grid:has(.gg-tile:nth-child(2):last-child) {
    flex-direction: column !important;
    align-items: stretch !important;
  }
  
  .gg-grid:has(.gg-tile:nth-child(2):last-child) .gg-tile {
    width: 95vw !important;
    height: calc(42vh - 48px) !important;
    height: calc(42dvh - 48px) !important;
    max-width: 95vw !important;
    max-height: calc(42vh - 48px) !important;
    flex: 1 !important;
  }
  
  /* For 3-4 participants: 2x2 grid that fills screen */
  .gg-grid:has(.gg-tile:nth-child(3)) .gg-tile,
  .gg-grid:has(.gg-tile:nth-child(4)) .gg-tile {
    width: calc(47vw - 2px) !important;
    height: calc(40vh - 48px) !important;
    height: calc(40dvh - 48px) !important;
    max-width: calc(47vw - 2px) !important;
    max-height: calc(40vh - 48px) !important;
  }
  
  /* For 5+ participants: smaller tiles in grid */
  .gg-grid:has(.gg-tile:nth-child(5)) .gg-tile {
    width: calc(32vw - 3px) !important;
    height: calc(25vh - 32px) !important;
    height: calc(25dvh - 32px) !important;
    max-width: calc(32vw - 3px) !important;
    max-height: calc(25vh - 32px) !important;
  }
  
  /* Video inside tiles should fill completely but allow stabilization */
  .lk-participant-tile{
    width: 100% !important;
    height: 100% !important;
  }
  
  .lk-participant-tile video{
    width: 100%;
    height: 100%;
    /* Allow stabilizer to control object-fit */
    object-fit: var(--mobile-object-fit, contain);
  }
  
  /* Mobile stabilization support */
  .lk-participant-tile video.video-stabilized {
    object-fit: cover !important;
    object-position: center center !important;
    width: var(--stable-width, 100%) !important;
    height: var(--stable-height, 100%) !important;
  }
  
  /* Mobile placeholder adjustments */
  .gg-placeholder{
    width: 100% !important;
    height: 100% !important;
  }
}

/* Enhanced grid container */
.gg-grid{
  padding-bottom:calc(var(--tool-h,56px) + env(safe-area-inset-bottom,0px));
  transition: all 0.3s ease;
}

/* ROBUST SPEAKING INDICATOR - ZERO LAYOUT SHIFTS */
.gg-tile.speaking{
  /* COMPLETELY DISABLE ALL ANIMATIONS */
  animation: none !important;
  transform: none !important;
  transition: none !important;
  will-change: auto !important;
  
  /* Static visual indicator only - no movement */
  box-shadow: 
    0 0 0 2px rgba(59, 130, 246, 0.9),
    0 0 0 4px rgba(59, 130, 246, 0.5),
    0 0 10px rgba(59, 130, 246, 0.3) !important;
  
  /* Force stable layout containment */
  contain: layout style size paint !important;
  
  /* Prevent any child animations */
  * {
    animation: none !important;
    transform: none !important;
    transition: none !important;
    will-change: auto !important;
  }
}

/* REMOVE ALL SPEAKING ANIMATIONS */
@keyframes speaking-pulse {
  /* Animation disabled - keeping keyframe to prevent CSS errors */
  0%, 100% { transform: none; }
}

/* FORCE DISABLE ALL SPEAKING ANIMATIONS FOR ACCESSIBILITY */
@media (prefers-reduced-motion: reduce) {
  .gg-tile.speaking {
    animation: none !important;
    transform: none !important;
    transition: none !important;
    box-shadow: 0 0 0 2px #3b82f6, 0 0 10px rgba(59, 130, 246, 0.4) !important;
  }
  
  .gg-tile.speaking .gg-placeholder {
    animation: none !important;
    transform: none !important;
    transition: none !important;
  }
}

/* Stabilize placeholder user icons - prevent jumping during speaking state changes */
.gg-placeholder {
  /* Force stable positioning and dimensions */
  position: relative;
  contain: layout style size;
  transform: translateZ(0); /* Hardware acceleration */
  will-change: auto; /* Reset will-change after animation */
  
  /* Prevent any inherited animations from affecting the icon */
  transition: none !important;
  animation: none !important;
}

/* Ensure IconUser inside placeholder is stable */
.gg-placeholder svg {
  transform: translateZ(0);
  transition: none !important;
  animation: none !important;
  
  /* Lock dimensions to prevent scaling issues */
  width: var(--icon-size, 48px) !important;
  height: var(--icon-size, 48px) !important;
  flex-shrink: 0;
}

/* COMPLETELY DISABLE PLACEHOLDER SPEAKING ANIMATIONS */
.gg-tile.speaking .gg-placeholder {
  /* NO ANIMATION WHATSOEVER */
  animation: none !important;
  transform: none !important;
  transition: none !important;
  will-change: auto !important;
  
  /* Static visual change only */
  opacity: 1 !important;
  
  /* Force layout stability */
  contain: layout style size !important;
}

/* DISABLE ALL PLACEHOLDER ANIMATIONS */
@keyframes placeholder-speaking {
  /* Animation disabled - keeping keyframe to prevent CSS errors */
  0%, 100% { 
    transform: none;
    opacity: 1;
  }
}

/* Focus accessibility */
.gg-tile:focus,.gg-btn:focus{
  outline:2px solid #3b82f6;
  outline-offset:2px;
}

/* Dark mode refinements */
@media (prefers-color-scheme: dark) {
  .gg-root { background: #0a0a0b; }
  .gg-tile { background: #1a1a1b; }
  .gg-placeholder { background: #111213; }
}